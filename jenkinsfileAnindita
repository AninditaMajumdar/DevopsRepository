node
{
def mvnHome
stage('Preparation')
{
git 'https://github.com/AninditaMajumdar/DevopsRepository.git'
}

stage ('mvn clean install command'){
BUILD_VERSION_GENERATED = VersionNumber(
        versionNumberString: '0.0.1.${BUILDS_ALL_TIME, X}',
        projectStartDate:    '2018-10-21',
        skipFailedBuilds:    true)
currentBuild.displayName = BUILD_VERSION_GENERATED
sh 'mvn clean install'
}
stage('Sonar Running'){
  sh 'mvn sonar:sonar -Dsonar.host.url=http://my31407dns.eastus2.cloudapp.azure.com'
}
stage ('deploying artifact'){
def server =Artifactory.server 'ArtifactoryID'
def uploadSpec="""{
"files":[
{
  "pattern":"target/*.war",
  "target":"repo/"
}
]
}"""
server.upload(uploadSpec)
}
stage('downloading artifact')
{
def server =Artifactory.server 'ArtifactoryID'
def downloadSpec="""{
"files":[
{
"pattern":"repo/*.war",
"target":"/var/lib/jenkins/workspace/DownloadingArtifact/"
}
]
}"""
server.download(downloadSpec)
}

}
